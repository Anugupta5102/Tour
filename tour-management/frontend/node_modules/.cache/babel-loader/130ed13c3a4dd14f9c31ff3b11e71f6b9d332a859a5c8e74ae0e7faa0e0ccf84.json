{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\DELL\\\\Desktop\\\\MernStack-Tour-Management\\\\tour-management\\\\frontend\\\\src\\\\components\\\\payment\\\\PaymentForm.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { loadStripe } from '@stripe/stripe-js';\nimport { Alert, Button } from 'reactstrap';\nimport { createPaymentIntent, confirmPayment } from '../../services/api';\nimport LoadingSpinner from '../common/LoadingSpinner';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst stripePromise = loadStripe(process.env.REACT_APP_STRIPE_PUBLIC_KEY);\nconst PaymentForm = _ref => {\n  _s();\n  let {\n    booking\n  } = _ref;\n  const navigate = useNavigate();\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [clientSecret, setClientSecret] = useState('');\n  useEffect(() => {\n    const initializePayment = async () => {\n      try {\n        const response = await createPaymentIntent(booking.totalAmount);\n        setClientSecret(response.data.clientSecret);\n      } catch (err) {\n        setError('Failed to initialize payment');\n      } finally {\n        setLoading(false);\n      }\n    };\n    initializePayment();\n  }, [booking.totalAmount]);\n  const handlePayment = async () => {\n    try {\n      var _elements;\n      setLoading(true);\n      const stripe = await stripePromise;\n      const {\n        paymentIntent,\n        error\n      } = await stripe.confirmCardPayment(clientSecret, {\n        payment_method: {\n          card: (_elements = elements) === null || _elements === void 0 ? void 0 : _elements.getElement('card'),\n          billing_details: {\n            name: booking.userId.name\n          }\n        }\n      });\n      if (error) {\n        setError(error.message);\n        return;\n      }\n      if (paymentIntent.status === 'succeeded') {\n        await confirmPayment(booking._id, paymentIntent.id);\n        navigate('/bookings', {\n          state: {\n            success: true,\n            message: 'Payment successful!'\n          }\n        });\n      }\n    } catch (err) {\n      setError('Payment failed. Please try again.');\n    } finally {\n      setLoading(false);\n    }\n  };\n  if (loading) return /*#__PURE__*/_jsxDEV(LoadingSpinner, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 63,\n    columnNumber: 23\n  }, this);\n  if (error) return /*#__PURE__*/_jsxDEV(Alert, {\n    color: \"danger\",\n    children: error\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 64,\n    columnNumber: 21\n  }, this);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"payment-form p-4 bg-light rounded shadow-sm\",\n    children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n      className: \"mb-4\",\n      children: \"Payment Details\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mb-4\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"card-element\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 70,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 69,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Button, {\n      color: \"primary\",\n      size: \"lg\",\n      block: true,\n      onClick: handlePayment,\n      disabled: loading,\n      children: loading ? 'Processing...' : 'Pay Now'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 67,\n    columnNumber: 5\n  }, this);\n};\n_s(PaymentForm, \"jNU2gyLJh46iXFK/26xnYCHY65w=\", false, function () {\n  return [useNavigate];\n});\n_c = PaymentForm;\nexport default PaymentForm;\nvar _c;\n$RefreshReg$(_c, \"PaymentForm\");","map":{"version":3,"names":["React","useState","useEffect","useNavigate","loadStripe","Alert","Button","createPaymentIntent","confirmPayment","LoadingSpinner","jsxDEV","_jsxDEV","stripePromise","process","env","REACT_APP_STRIPE_PUBLIC_KEY","PaymentForm","_ref","_s","booking","navigate","loading","setLoading","error","setError","clientSecret","setClientSecret","initializePayment","response","totalAmount","data","err","handlePayment","_elements","stripe","paymentIntent","confirmCardPayment","payment_method","card","elements","getElement","billing_details","name","userId","message","status","_id","id","state","success","fileName","_jsxFileName","lineNumber","columnNumber","color","children","className","size","block","onClick","disabled","_c","$RefreshReg$"],"sources":["C:/Users/DELL/Desktop/MernStack-Tour-Management/tour-management/frontend/src/components/payment/PaymentForm.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { loadStripe } from '@stripe/stripe-js';\nimport { Alert, Button } from 'reactstrap';\nimport { createPaymentIntent, confirmPayment } from '../../services/api';\nimport LoadingSpinner from '../common/LoadingSpinner';\n\nconst stripePromise = loadStripe(process.env.REACT_APP_STRIPE_PUBLIC_KEY);\n\nconst PaymentForm = ({ booking }) => {\n  const navigate = useNavigate();\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [clientSecret, setClientSecret] = useState('');\n\n  useEffect(() => {\n    const initializePayment = async () => { \n      try {\n        const response = await createPaymentIntent(booking.totalAmount);\n        setClientSecret(response.data.clientSecret);\n      } catch (err) {\n        setError('Failed to initialize payment');\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    initializePayment();\n  }, [booking.totalAmount]);\n\n  const handlePayment = async () => {\n    try {\n      setLoading(true);\n      const stripe = await stripePromise;\n      \n      const { paymentIntent, error } = await stripe.confirmCardPayment(clientSecret, {\n        payment_method: {\n          card: elements?.getElement('card'),\n          billing_details: {\n            name: booking.userId.name,\n          },\n        },\n      });\n\n      if (error) {\n        setError(error.message);\n        return;\n      }\n\n      if (paymentIntent.status === 'succeeded') {\n        await confirmPayment(booking._id, paymentIntent.id);\n        navigate('/bookings', { \n          state: { success: true, message: 'Payment successful!' }\n        });\n      }\n    } catch (err) {\n      setError('Payment failed. Please try again.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (loading) return <LoadingSpinner />;\n  if (error) return <Alert color=\"danger\">{error}</Alert>;\n\n  return (\n    <div className=\"payment-form p-4 bg-light rounded shadow-sm\">\n      <h4 className=\"mb-4\">Payment Details</h4>\n      <div className=\"mb-4\">\n        <div id=\"card-element\">\n          {/* Stripe Card Element will be inserted here */}\n        </div>\n      </div>\n      <Button\n        color=\"primary\"\n        size=\"lg\"\n        block\n        onClick={handlePayment}\n        disabled={loading}\n      >\n        {loading ? 'Processing...' : 'Pay Now'}\n      </Button>\n    </div>\n  );\n};\n\nexport default PaymentForm;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}